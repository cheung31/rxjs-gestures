{"version":3,"sources":["../../src/operators/NormalizeOperator.js"],"names":["NormalizeOperator","origin","Gestures","scheduler","undefined","subscriber","source","_subscribe","NormalizeSubscriber","previous","lastWindowTime","now","multitouchEvent","time","type","index","event","touch","target","screenX","screenY","pageX","pageY","clientX","clientY","deltaX","deltaY","deltaZ","radiusX","radiusY","rotationAngle","createOrigin","prevX","prevY","movementX","movementY","movementT","movementXTotal","movementYTotal","movementTTotal","direction","Math","atan2","magnitude","abs","sqrt","pow","point","clone","x","y","targetX","targetY","targetPageX","targetPageY","targetClientX","targetClientY","targetScreenX","targetScreenY","identifier","topLevelElement","offsetParent","offsetLeft","offsetTop","scrollTop","scrollLeft","getBoundingClientRect","targetTop","top","targetLeft","left","targetRight","right","targetBottom","bottom","parentTop","parentLeft","parentRight","parentBottom","pageXOffset","pageYOffset","xOrigin","yOrigin","pageXOrigin","pageYOrigin","clientXOrigin","clientYOrigin","screenXOrigin","screenYOrigin","targetXOrigin","targetYOrigin","targetPageXOrigin","targetPageYOrigin","targetClientXOrigin","targetClientYOrigin","targetScreenXOrigin","targetScreenYOrigin"],"mappings":"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","file":"NormalizeOperator.js","sourcesContent":["import { Point } from '../support';\nimport { Subscriber } from 'rxjs';\n\nexport class NormalizeOperator {\n    constructor(origin, Gestures, scheduler) {\n        this.origin = origin || undefined;\n        this.Gestures = Gestures;\n        this.scheduler = scheduler;\n    }\n    call(subscriber, source) {\n        return source._subscribe(new NormalizeSubscriber(subscriber, this.origin, this.Gestures, this.scheduler));\n    }\n}\n\nexport class NormalizeSubscriber extends Subscriber {\n    constructor(subscriber, origin, Gestures, scheduler) {\n        super(subscriber);\n        this.origin = origin;\n        this.previous = origin;\n        this.Gestures = Gestures;\n        this.scheduler = scheduler;\n        this.lastWindowTime = scheduler.now();\n    }\n    _next(multitouchEvent) {\n\n        if (multitouchEvent instanceof Point) {\n            return super._next(this.previous = multitouchEvent);\n        }\n\n        const time = this.scheduler.now();\n        let { origin, lastWindowTime } = this;\n        const { type, index, event, touch, target, screenX, screenY,\n                pageX, pageY, clientX, clientY, deltaX, deltaY, deltaZ,\n                radiusX = 1, radiusY = 1, rotationAngle = 0 } = multitouchEvent;\n\n        if (!origin) {\n            this.origin = origin = NormalizeSubscriber.createOrigin(\n                multitouchEvent, touch, time, this.Gestures\n            );\n        }\n\n        const { previous = origin } = this;\n        const { pageX: prevX, pageY: prevY } = previous;\n\n        const movementX = pageX - prevX;\n        const movementY = pageY - prevY;\n        const movementT = time - previous.time;\n        const movementXTotal = movementX + previous.movementXTotal;\n        const movementYTotal = movementY + previous.movementYTotal;\n        const movementTTotal = movementT + previous.movementTTotal;\n        const direction = Math.atan2(movementY / movementT, movementX / movementT) || 0;\n        const magnitude = Math.abs(\n            Math.sqrt(Math.pow(pageX, 2) + Math.pow(pageY, 2)) -\n            Math.sqrt(Math.pow(prevX, 2) + Math.pow(prevY, 2)),\n        );\n\n        const point = origin.clone();\n\n        point.type = type;\n        point.time = time;\n        point.index = index;\n        point.touch = touch;\n        point.event = event;\n        point.pageX = pageX;\n        point.pageY = pageY;\n        point.movementT = movementT;\n        point.movementX = movementX;\n        point.movementY = movementY;\n        point.deltaX = deltaX;\n        point.deltaY = deltaY;\n        point.deltaZ = deltaZ;\n        point.clientX = clientX;\n        point.clientY = clientY;\n        point.screenX = screenX;\n        point.screenY = screenY;\n        point.radiusX = radiusX;\n        point.radiusY = radiusY;\n        point.magnitude = magnitude;\n        point.direction = direction;\n        point.rotationAngle = rotationAngle;\n        point.movementXTotal = movementXTotal;\n        point.movementYTotal = movementYTotal;\n        point.movementTTotal = movementTTotal;\n\n        point.x += movementXTotal;\n        point.y += movementYTotal;\n        point.targetX += movementXTotal;\n        point.targetY += movementYTotal;\n        point.targetPageX += movementXTotal;\n        point.targetPageY += movementYTotal;\n        point.targetClientX += movementXTotal;\n        point.targetClientY += movementYTotal;\n        point.targetScreenX += movementXTotal;\n        point.targetScreenY += movementYTotal;\n\n        super._next(this.previous = point);\n    }\n    static createOrigin(event, touch, time, Gestures) {\n\n        const { identifier } = touch;\n        const { topLevelElement } = Gestures;\n        const { type, target, pageX, pageY,\n                clientX, clientY, screenX, screenY,\n                radiusX = 1, radiusY = 1, rotationAngle = 0 } = event;\n\n        const { offsetParent = topLevelElement,\n                offsetLeft, offsetTop, scrollTop, scrollLeft } = target;\n\n        const { top: targetTop, left: targetLeft,\n                right: targetRight, bottom: targetBottom } = target.getBoundingClientRect();\n\n        const { top: parentTop, left: parentLeft,\n                right: parentRight, bottom: parentBottom } = offsetParent.getBoundingClientRect();\n\n\n        const x = clientX - targetLeft - scrollLeft;\n        const y = clientY - targetTop - scrollTop;\n        const targetPageX = targetLeft - scrollLeft + topLevelElement.pageXOffset;\n        const targetPageY = targetTop - scrollTop + topLevelElement.pageYOffset;\n        const targetX = targetLeft - parentLeft - offsetLeft - scrollLeft;\n        const targetY = targetTop - parentTop - offsetTop - scrollTop;\n        const targetClientX = targetLeft - scrollLeft;\n        const targetClientY = targetTop - scrollTop;\n        const targetScreenX = (screenX - clientX) + targetLeft - scrollLeft;\n        const targetScreenY = (screenY - clientY) + targetTop - scrollTop;\n\n        const origin = new Point(time, null, null, target, identifier,\n                                 radiusX, radiusY, rotationAngle,\n                                 x, y,\n                                 pageX, pageY,\n                                 clientX, clientY,\n                                 screenX, screenY,\n                                 targetX, targetY,\n                                 targetPageX, targetPageY,\n                                 targetClientX, targetClientY,\n                                 targetScreenX, targetScreenY);\n        origin.type = type;\n        origin.xOrigin = origin.x;\n        origin.yOrigin = origin.y;\n        origin.targetTop = targetTop;\n        origin.targetLeft = targetLeft;\n        origin.targetRight = targetRight;\n        origin.targetBottom = targetBottom;\n        origin.parentTop = parentTop;\n        origin.parentLeft = parentLeft;\n        origin.parentRight = parentRight;\n        origin.parentBottom = parentBottom;\n        origin.pageXOrigin = origin.pageX;\n        origin.pageYOrigin = origin.pageY;\n        origin.clientXOrigin = origin.clientX;\n        origin.clientYOrigin = origin.clientY;\n        origin.screenXOrigin = origin.screenX;\n        origin.screenYOrigin = origin.screenY;\n        origin.targetXOrigin = origin.targetX;\n        origin.targetYOrigin = origin.targetY;\n        origin.targetPageXOrigin = origin.targetPageX;\n        origin.targetPageYOrigin = origin.targetPageY;\n        origin.targetClientXOrigin = origin.targetClientX;\n        origin.targetClientYOrigin = origin.targetClientY;\n        origin.targetScreenXOrigin = origin.targetScreenX;\n        origin.targetScreenYOrigin = origin.targetScreenY;\n\n        return origin;\n    }\n}\n"]}