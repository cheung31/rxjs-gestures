{"version":3,"sources":["../../src/operators/DecelerateOperator.js"],"names":[],"mappings":"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","file":"DecelerateOperator.js","sourcesContent":["import { Subscriber } from 'rxjs';\n\nexport class DecelerateOperator {\n    constructor(u, normalForce, scheduler) {\n        this.u = u;\n        this.normalForce = normalForce;\n        this.scheduler = scheduler;\n    }\n    call(subscriber, source) {\n        return source._subscribe(new DecelerateSubscriber(\n            subscriber, this.u, this.normalForce, this.scheduler\n        ));\n    }\n}\n\nexport class DecelerateSubscriber extends Subscriber {\n    constructor(destination, u, normalForce, scheduler) {\n        super(destination, null, scheduler);\n        this.u = u;\n        this.point = null;\n        this.hasPoint = false;\n        this.scheduler = scheduler;\n        this.normalForce = normalForce;\n    }\n    _next(point) {\n        super._next((this.hasPoint = true) && (this.point = point));\n    }\n    _complete() {\n\n        if (!this.hasPoint) {\n            return super._complete();\n        }\n\n        const { u, normalForce, point, scheduler } = this;\n        const { index = 0, movementTTotal, direction, magnitude = 0 } = point;\n\n        if (index <= 0) {\n            return super._complete();\n        }\n\n        const duration = Math.sqrt((magnitude / (movementTTotal / index)) / (normalForce * u)) || 0;\n\n        if (duration <= 0) {\n            return super._complete();\n        }\n\n        const distanceX = Math.cos(direction) * magnitude * duration;\n        const distanceY = Math.sin(direction) * magnitude * duration;\n\n        this.add(scheduler.schedule(DecelerateSubscriber.dispatch, 0, {\n            time: scheduler.now(),\n            point, start: point,\n            duration: duration * 100,\n            subscriber: this.destination,\n            distanceX, distanceY, scheduler,\n        }));\n    }\n    static dispatch(state) {\n\n        let { time, start, point,\n              scheduler, subscriber,\n              distanceX, distanceY, duration } = state;\n\n        const now = scheduler.now();\n        const elapsed = now - time;\n\n        if (elapsed > duration) {\n            subscriber.complete();\n        } else {\n\n            const easingFunc = quadOut;\n            const pageX = easingFunc(elapsed, start.pageX, distanceX, duration);\n            const pageY = easingFunc(elapsed, start.pageY, distanceY, duration);\n            const targetPageX = easingFunc(elapsed, start.targetPageX, distanceX, duration);\n            const targetPageY = easingFunc(elapsed, start.targetPageY, distanceX, duration);\n\n            point = point.clone();\n\n            point.movementT = now - point.time;\n            point.movementX = pageX - point.pageX;\n            point.movementY = pageY - point.pageY;\n            point.movementXTotal = point.movementX + point.movementXTotal;\n            point.movementYTotal = point.movementY + point.movementYTotal;\n            point.x = easingFunc(elapsed, start.x, distanceX, duration);\n            point.y = easingFunc(elapsed, start.y, distanceY, duration);\n            point.clientX = easingFunc(elapsed, start.clientX, distanceX, duration);\n            point.clientY = easingFunc(elapsed, start.clientY, distanceY, duration);\n            point.screenX = easingFunc(elapsed, start.screenX, distanceX, duration);\n            point.screenY = easingFunc(elapsed, start.screenY, distanceY, duration);\n            point.targetX = easingFunc(elapsed, start.targetX, distanceX, duration);\n            point.targetY = easingFunc(elapsed, start.targetY, distanceY, duration);\n            point.targetPageX = easingFunc(elapsed, start.targetPageX, distanceX, duration);\n            point.targetPageY = easingFunc(elapsed, start.targetPageY, distanceY, duration);\n            point.targetClientX = easingFunc(elapsed, start.targetClientX, distanceX, duration);\n            point.targetClientY = easingFunc(elapsed, start.targetClientY, distanceY, duration);\n            point.targetScreenX = easingFunc(elapsed, start.targetScreenX, distanceX, duration);\n            point.targetScreenY = easingFunc(elapsed, start.targetScreenY, distanceY, duration);\n\n            point.time = now;\n            point.pageX = pageX;\n            point.pageY = pageY;\n            state.point = point;\n\n            subscriber.next(point);\n\n            this.schedule(state, 0);\n        }\n    }\n}\n\nfunction quadOut(time, begin, change, duration) {\n    return -change * (time = time / duration) * (time - 2) + begin;\n}\n"]}