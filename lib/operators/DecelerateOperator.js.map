{"version":3,"sources":["../../src/operators/DecelerateOperator.js"],"names":["DecelerateOperator","u","speedLimit","scheduler","Math","abs","pow","ceil","log10","subscriber","source","subscribe","DecelerateSubscriber","destination","point","hasPoint","index","movementT","direction","time","now","clone","speed","min","duration","distanceX","cos","distanceY","sin","unsubscribe","closed","isStopped","add","schedule","dispatch","start","state","easingFunc","quadOut","elapsed","pageX","pageY","movementX","movementY","movementXTotal","movementYTotal","x","y","clientX","clientY","screenX","screenY","targetX","targetY","targetPageX","targetPageY","targetClientX","targetClientY","targetScreenX","targetScreenY","next","complete","begin","change"],"mappings":"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","file":"DecelerateOperator.js","sourcesContent":["import { Subscriber } from 'rxjs/Subscriber';\n\nexport class DecelerateOperator {\n    constructor(u, speedLimit, scheduler) {\n        if (u === 0) { u = 100; }\n        if (u < 0) { u = Math.abs(u); }\n        if (u > 100) {\n            u /= Math.pow(10, Math.ceil(Math.log10(u))) * 100;\n        }\n        this.u = u / 100;\n        this.scheduler = scheduler;\n        this.speedLimit = Math.abs(speedLimit);\n    }\n    call(subscriber, source) {\n        return source.subscribe(new DecelerateSubscriber(\n            subscriber, this.u, this.speedLimit, this.scheduler\n        ));\n    }\n}\n\nexport class DecelerateSubscriber extends Subscriber {\n    constructor(destination, u, speedLimit, scheduler) {\n        super(destination, null, scheduler);\n        this.u = u;\n        this.point = null;\n        this.hasPoint = false;\n        this.scheduler = scheduler;\n        this.speedLimit = speedLimit;\n    }\n    _next(point) {\n        super._next((this.hasPoint = true) && (this.point = point));\n    }\n    _complete() {\n\n        if (!this.hasPoint) {\n            return super._complete();\n        }\n\n        const { u, point, speedLimit, scheduler } = this;\n        const { index = 0, movementT = 1, direction } = point;\n\n        if (!index || index <= 0) {\n            return super._complete();\n        }\n\n        const time = scheduler.now();\n\n        if (time - point.time >= 25) {\n            super._next(point.clone({ speed: 0 }));\n            return super._complete();\n        }\n\n        const speed = Math.min(speedLimit, point.speed) || 0;\n        const duration = 1000 * (speed / (9.8 /*normalForce*/ * u)) || 0;\n\n        if (!duration || duration <= 0) {\n            return super._complete();\n        }\n\n        const distanceX = Math.cos(direction) * speed * duration;\n        const distanceY = Math.sin(direction) * speed * duration;\n\n        this.unsubscribe();\n        this.closed = this.isStopped = false;\n        this.add(scheduler.schedule(DecelerateSubscriber.dispatch, 0, {\n            start: point,\n            time, point, duration,\n            subscriber: this.destination,\n            distanceX, distanceY, scheduler,\n        }));\n    }\n    static dispatch(state) {\n\n        let { time, start, point,\n              scheduler, subscriber,\n              distanceX, distanceY, duration } = state;\n\n        const easingFunc = quadOut;\n        const now = scheduler.now();\n        const elapsed = Math.min(now - time, duration);\n        const pageX = easingFunc(elapsed, start.pageX, distanceX, duration);\n        const pageY = easingFunc(elapsed, start.pageY, distanceY, duration);\n\n        point = point.clone();\n\n        point.movementT = now - point.time;\n        point.movementX = pageX - point.pageX;\n        point.movementY = pageY - point.pageY;\n        point.movementXTotal = point.movementX + point.movementXTotal;\n        point.movementYTotal = point.movementY + point.movementYTotal;\n        point.x = easingFunc(elapsed, start.x, distanceX, duration);\n        point.y = easingFunc(elapsed, start.y, distanceY, duration);\n        point.speed = easingFunc(elapsed, start.speed, - start.speed, duration);\n        point.clientX = easingFunc(elapsed, start.clientX, distanceX, duration);\n        point.clientY = easingFunc(elapsed, start.clientY, distanceY, duration);\n        point.screenX = easingFunc(elapsed, start.screenX, distanceX, duration);\n        point.screenY = easingFunc(elapsed, start.screenY, distanceY, duration);\n        point.targetX = easingFunc(elapsed, start.targetX, distanceX, duration);\n        point.targetY = easingFunc(elapsed, start.targetY, distanceY, duration);\n        point.targetPageX = easingFunc(elapsed, start.targetPageX, distanceX, duration);\n        point.targetPageY = easingFunc(elapsed, start.targetPageY, distanceY, duration);\n        point.targetClientX = easingFunc(elapsed, start.targetClientX, distanceX, duration);\n        point.targetClientY = easingFunc(elapsed, start.targetClientY, distanceY, duration);\n        point.targetScreenX = easingFunc(elapsed, start.targetScreenX, distanceX, duration);\n        point.targetScreenY = easingFunc(elapsed, start.targetScreenY, distanceY, duration);\n\n        point.time = now;\n        point.pageX = pageX;\n        point.pageY = pageY;\n        state.point = point;\n\n        subscriber.next(point);\n\n        if (elapsed >= duration) {\n            subscriber.complete();\n        } else {\n            this.schedule(state, 0);\n        }\n    }\n}\n\nfunction quadOut(time, begin, change, duration) {\n    return -change * (time = time / duration) * (time - 2) + begin;\n}\n"]}