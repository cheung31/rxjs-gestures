{"version":3,"sources":["../../src/operators/DecelerateOperator.js"],"names":["DecelerateOperator","u","speedLimit","scheduler","Math","abs","pow","ceil","log10","subscriber","source","_subscribe","DecelerateSubscriber","destination","point","hasPoint","index","movementT","direction","magnitude","min","duration","sqrt","distanceX","cos","distanceY","sin","add","schedule","dispatch","start","time","now","state","elapsed","complete","easingFunc","quadOut","pageX","pageY","clone","movementX","movementY","movementXTotal","movementYTotal","x","y","clientX","clientY","screenX","screenY","targetX","targetY","targetPageX","targetPageY","targetClientX","targetClientY","targetScreenX","targetScreenY","next","begin","change"],"mappings":"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","file":"DecelerateOperator.js","sourcesContent":["import { Subscriber } from 'rxjs';\n\nexport class DecelerateOperator {\n    constructor(u, speedLimit, scheduler) {\n        if (u === 0) { u = 1; }\n        if (u < 0) { u = Math.abs(u); }\n        if (u > 100) {\n            u /= Math.pow(10, Math.ceil(Math.log10(u))) * 100;\n        }\n        this.u = u / 100;\n        this.speedLimit = Math.abs(speedLimit);\n        this.scheduler = scheduler;\n    }\n    call(subscriber, source) {\n        return source._subscribe(new DecelerateSubscriber(\n            subscriber, this.u, this.speedLimit, this.scheduler\n        ));\n    }\n}\n\nexport class DecelerateSubscriber extends Subscriber {\n    constructor(destination, u, speedLimit, scheduler) {\n        super(destination, null, scheduler);\n        this.u = u;\n        this.point = null;\n        this.hasPoint = false;\n        this.scheduler = scheduler;\n        this.speedLimit = speedLimit;\n    }\n    _next(point) {\n        super._next((this.hasPoint = true) && (this.point = point));\n    }\n    _complete() {\n\n        if (!this.hasPoint) {\n            return super._complete();\n        }\n\n        const { u, point, speedLimit, scheduler } = this;\n        const { index = 0, movementT = 1, direction } = point;\n\n        if (!index || index <= 0) {\n            return super._complete();\n        }\n\n        const magnitude = Math.min(point.magnitude, speedLimit);\n        const duration = Math.sqrt((magnitude / movementT) / (9.8 /*normalForce*/ * u)) || 0;\n\n        if (!duration || duration <= 0) {\n            return super._complete();\n        }\n\n        const distanceX = Math.cos(direction) * magnitude * duration;\n        const distanceY = Math.sin(direction) * magnitude * duration;\n\n        this.add(scheduler.schedule(DecelerateSubscriber.dispatch, 0, {\n            point,\n            start: point,\n            time: scheduler.now(),\n            duration: duration * 100,\n            subscriber: this.destination,\n            distanceX, distanceY, scheduler,\n        }));\n    }\n    static dispatch(state) {\n\n        let { time, start, point,\n              scheduler, subscriber,\n              distanceX, distanceY, duration } = state;\n\n        const now = scheduler.now();\n        const elapsed = now - time;\n\n        if (elapsed > duration) {\n            subscriber.complete();\n        } else {\n\n            const easingFunc = quadOut;\n            const pageX = easingFunc(elapsed, start.pageX, distanceX, duration);\n            const pageY = easingFunc(elapsed, start.pageY, distanceY, duration);\n\n            point = point.clone();\n\n            point.movementT = now - point.time;\n            point.movementX = pageX - point.pageX;\n            point.movementY = pageY - point.pageY;\n            point.movementXTotal = point.movementX + point.movementXTotal;\n            point.movementYTotal = point.movementY + point.movementYTotal;\n            point.x = easingFunc(elapsed, start.x, distanceX, duration);\n            point.y = easingFunc(elapsed, start.y, distanceY, duration);\n            point.clientX = easingFunc(elapsed, start.clientX, distanceX, duration);\n            point.clientY = easingFunc(elapsed, start.clientY, distanceY, duration);\n            point.screenX = easingFunc(elapsed, start.screenX, distanceX, duration);\n            point.screenY = easingFunc(elapsed, start.screenY, distanceY, duration);\n            point.targetX = easingFunc(elapsed, start.targetX, distanceX, duration);\n            point.targetY = easingFunc(elapsed, start.targetY, distanceY, duration);\n            point.targetPageX = easingFunc(elapsed, start.targetPageX, distanceX, duration);\n            point.targetPageY = easingFunc(elapsed, start.targetPageY, distanceY, duration);\n            point.targetClientX = easingFunc(elapsed, start.targetClientX, distanceX, duration);\n            point.targetClientY = easingFunc(elapsed, start.targetClientY, distanceY, duration);\n            point.targetScreenX = easingFunc(elapsed, start.targetScreenX, distanceX, duration);\n            point.targetScreenY = easingFunc(elapsed, start.targetScreenY, distanceY, duration);\n\n            point.time = now;\n            point.pageX = pageX;\n            point.pageY = pageY;\n            state.point = point;\n\n            subscriber.next(point);\n\n            this.schedule(state, 0);\n        }\n    }\n}\n\nfunction quadOut(time, begin, change, duration) {\n    return -change * (time = time / duration) * (time - 2) + begin;\n}\n"]}