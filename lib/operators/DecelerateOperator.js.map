{"version":3,"sources":["../../src/operators/DecelerateOperator.js"],"names":[],"mappings":"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","file":"DecelerateOperator.js","sourcesContent":["import { Subscriber } from 'rxjs';\n\nexport class DecelerateOperator {\n    constructor(u, speedLimit, scheduler) {\n        if (u === 0) { u = 1; }\n        if (u < 0) { u = Math.abs(u); }\n        if (u > 100) {\n            u /= Math.pow(10, Math.ceil(Math.log10(u))) * 100;\n        }\n        this.u = u / 100;\n        this.speedLimit = Math.abs(speedLimit);\n        this.scheduler = scheduler;\n    }\n    call(subscriber, source) {\n        return source._subscribe(new DecelerateSubscriber(\n            subscriber, this.u, this.speedLimit, this.scheduler\n        ));\n    }\n}\n\nexport class DecelerateSubscriber extends Subscriber {\n    constructor(destination, u, speedLimit, scheduler) {\n        super(destination, null, scheduler);\n        this.u = u;\n        this.point = null;\n        this.hasPoint = false;\n        this.scheduler = scheduler;\n        this.speedLimit = speedLimit;\n    }\n    _next(point) {\n        super._next((this.hasPoint = true) && (this.point = point));\n    }\n    _complete() {\n\n        if (!this.hasPoint) {\n            return super._complete();\n        }\n\n        const { u, point, speedLimit, scheduler } = this;\n        const { index = 0, movementT = 1, direction } = point;\n\n        if (!index || index <= 0) {\n            return super._complete();\n        }\n\n        const magnitude = Math.min(point.magnitude, speedLimit);\n        const duration = Math.sqrt((magnitude / movementT) / (9.8 /*normalForce*/ * u)) || 0;\n\n        if (!duration || duration <= 0) {\n            return super._complete();\n        }\n\n        const distanceX = Math.cos(direction) * magnitude * duration;\n        const distanceY = Math.sin(direction) * magnitude * duration;\n\n        this.add(scheduler.schedule(DecelerateSubscriber.dispatch, 0, {\n            point,\n            start: point,\n            time: scheduler.now(),\n            duration: duration * 100,\n            subscriber: this.destination,\n            distanceX, distanceY, scheduler,\n        }));\n    }\n    static dispatch(state) {\n\n        let { time, start, point,\n              scheduler, subscriber,\n              distanceX, distanceY, duration } = state;\n\n        const now = scheduler.now();\n        const elapsed = now - time;\n\n        if (elapsed > duration) {\n            subscriber.complete();\n        } else {\n\n            const easingFunc = quadOut;\n            const pageX = easingFunc(elapsed, start.pageX, distanceX, duration);\n            const pageY = easingFunc(elapsed, start.pageY, distanceY, duration);\n\n            point = point.clone();\n\n            point.movementT = now - point.time;\n            point.movementX = pageX - point.pageX;\n            point.movementY = pageY - point.pageY;\n            point.movementXTotal = point.movementX + point.movementXTotal;\n            point.movementYTotal = point.movementY + point.movementYTotal;\n            point.x = easingFunc(elapsed, start.x, distanceX, duration);\n            point.y = easingFunc(elapsed, start.y, distanceY, duration);\n            point.clientX = easingFunc(elapsed, start.clientX, distanceX, duration);\n            point.clientY = easingFunc(elapsed, start.clientY, distanceY, duration);\n            point.screenX = easingFunc(elapsed, start.screenX, distanceX, duration);\n            point.screenY = easingFunc(elapsed, start.screenY, distanceY, duration);\n            point.targetX = easingFunc(elapsed, start.targetX, distanceX, duration);\n            point.targetY = easingFunc(elapsed, start.targetY, distanceY, duration);\n            point.targetPageX = easingFunc(elapsed, start.targetPageX, distanceX, duration);\n            point.targetPageY = easingFunc(elapsed, start.targetPageY, distanceY, duration);\n            point.targetClientX = easingFunc(elapsed, start.targetClientX, distanceX, duration);\n            point.targetClientY = easingFunc(elapsed, start.targetClientY, distanceY, duration);\n            point.targetScreenX = easingFunc(elapsed, start.targetScreenX, distanceX, duration);\n            point.targetScreenY = easingFunc(elapsed, start.targetScreenY, distanceY, duration);\n\n            point.time = now;\n            point.pageX = pageX;\n            point.pageY = pageY;\n            state.point = point;\n\n            subscriber.next(point);\n\n            this.schedule(state, 0);\n        }\n    }\n}\n\nfunction quadOut(time, begin, change, duration) {\n    return -change * (time = time / duration) * (time - 2) + begin;\n}\n"]}